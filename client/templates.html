<template name="navigation">
	<h1><a href="{{ pathFor 'browse' page=1 }}">eboydb</a>: {{ postsCount }} docs â€“ p{{ currentPage }}/{{ totalPages }}</h1>
	<input type="file" name="myFile" class="myPixInput">
</template>


<template name="browse">
	{{> navigation }}
	<div class="paging">
		<span class="previous">previous</span> | 
		<span class="next">next</span>
	</div>
	<div class="container">
		{{#each showPix}}

			<div class="docbox" style="background-color: {{ this.metadata.backColor }}">
				<div class="docinfo"><span class='remove'>X</span> {{ this.metadata.backColor }} {{ toWidth }}px {{ factor }}x</div>
				<figure>
					<a href="{{ pathFor 'doc' }}"><img src="{{ this.url store='ThumbsPix' }}" width="{{ toWidth }}" /></a>
				</figure>
			</div>

		{{/each}}
	</div>
</template>

<template name="doc">
	<h1><a href="" class="goBack">eboydb</a>: {{ this._id }} </h1>
	<div class="showDocFull">
		<figure>
			<a href="{{ pathFor 'tester' }}">
				<img style="background-color: {{ this.metadata.backColor }}" src="{{ this.url 	store='OriginalPix' }}" width="{{ this.metadata.width }}" height="{{ this.metadata.height }}" />
			</a>

	<figcaption>
		<ol>
			<li><span class="property">name</span>: {{ this.name }}</li>
			<li><span class="property">uploadedAt</span>: {{this.uploadedAt}}</li>
			<li><span class="property">metadata.width</span>: {{this.metadata.width}}</li>
			<li><span class="property">metadata.height</span>: {{this.metadata.height}}</li>
			<li><span class="property">metadata.copyright</span>: {{this.metadata.copyright}}</li>
			<li><span class="property">metadata.tags</span>: {{this.metadata.tags}}</li>
			<li><span class="property">metadata.backColor</span>: {{ this.metadata.backColor }}</li>
		</ol>
	</figcaption>
		</figure>
		<form>
			<div>tags: <input type="text" name="tags" value="{{this.metadata.tags}}"></div>
			<div>background-color: <input type="text" name="backColor" value="{{this.metadata.backColor}}"></div>
			<input type="submit" name="updatetags">
		</form>
	</div>
</template>

<!-- //////////////////////////////////// TESTS -->
<template name="tester">
	<script>
		var myImage = new Image();
		myImage.src="{{ this.url store='OriginalPix' }}";
		myImage.onload = function() {
			var c = document.getElementById("myCanvas");
			var ctx = c.getContext("2d");
			ctx.fillStyle = "{{ this.metadata.backColor }}";
			ctx.fillRect(0, 0, {{ scaledSprite.widthDevice }}, {{ scaledSprite.heightDevice }});
			ctx.imageSmoothingEnabled = false;
			ctx.drawImage(myImage, 0, 0, {{ scaledSprite.widthDevice }}, {{ scaledSprite.heightDevice }});
			var ratio = window.devicePixelRatio;
			console.log('window.devicePixelRatio: ' + window.devicePixelRatio);
	
			// generate png from canvas
			var foo = document.getElementById("genImg");
			var dataURL = c.toDataURL("image/png");
			// foo.src = imageGenerated;
			foo.href = dataURL;
		}
	</script>
	<div class="box" style="">
		<canvas id="myCanvas" width="{{ scaledSprite.widthDevice }}" height="{{ scaledSprite.heightDevice }}" style="width:{{ scaledSprite.width }}px; height: {{ scaledSprite.height }}px;">
			This browser does not support HTML5 canvas
		</canvas>
	</div>
	<!-- <img id="genImg" src="myPicture.png" alt="Description of my picture" /> -->
	<a id="genImg" href="">Download PNG</a>
	<figcaption>
		<ol>
			<li><span class="property">name</span>: {{ this.name }}</li>
			<li><span class="property">uploadedAt</span>: {{this.uploadedAt}}</li>
			<li><span class="property">metadata.width</span>: {{this.metadata.width}}</li>
			<li><span class="property">metadata.height</span>: {{this.metadata.height}}</li>
			<li><span class="property">metadata.copyright</span>: {{this.metadata.copyright}}</li>
			<li><span class="property">metadata.tags</span>: {{this.metadata.tags}}</li>
			<li><span class="property">metadata.backColor</span>: {{ this.metadata.backColor }}</li>
		</ol>
		<ol>
			<li><span class="property">scaledSprite.width</span>: {{ scaledSprite.width }}</li>
			<li><span class="property">scaledSprite.height</span>: {{ scaledSprite.height }}</li>
			<li><span class="property">scaledSprite.scaleFactor</span>: {{ scaledSprite.scaleFactor }}x</li>
			<li><span class="property">window.devicePixelRatio</span>: {{ devicePixelRatio }} </li>
			<li><span class="property">scaledSprite.widthDevice</span>: {{ scaledSprite.widthDevice }}</li>
			<li><span class="property">scaledSprite.heightDevice</span>: {{ scaledSprite.heightDevice }}</li>
			<li><span class="property">scaledSprite.scaleFactorDevice</span>: {{ scaledSprite.scaleFactorDevice }}x</li>
		</ol>
	</figcaption>
	<div>
		<img id="scream" src="{{ this.url store='OriginalPix' }}" width="{{ this.metadata.width }}" height="{{ this.metadata.height }}" />
	</div>
</template>